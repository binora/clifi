#!/bin/bash
# Git pre-commit hook - runs fmt, lint, and test before allowing commits

set -e

echo "Running pre-commit checks..."

# Format code
echo "=> Running go fmt..."
go fmt ./...

# Check if formatting changed any files
if ! git diff --quiet; then
    echo "ERROR: go fmt modified files. Please stage the changes and try again."
    git diff --name-only
    exit 1
fi

# Run linter
echo "=> Running golangci-lint..."
if command -v golangci-lint &> /dev/null; then
    golangci-lint run ./...
else
    echo "WARNING: golangci-lint not installed, skipping lint check"
    echo "Install with: go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest"
fi

# Run tests
echo "=> Running tests..."
go test ./...

echo "All pre-commit checks passed!"
